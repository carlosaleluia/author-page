---
interface Props {
	title: string;
	description?: string;
}

const { title, description = 'Escritor português' } = Astro.props;
const currentPath = Astro.url.pathname.replace(/\/$/, '') || '/';

// Para o dropdown de livros
import { getSortedBooks } from '../lib/books';
const books = await getSortedBooks();
---

<!doctype html>
<html lang="pt">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<meta name="description" content={description} />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<title>{title}</title>
		<style is:global>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			:root {
				--text-primary: #1a1a1a;
				--text-secondary: #666;
				--border-color: #e5e5e5;
				--bg-hover: #f9f9f9;
				--accent-color: #e6f2ff;
				--active-color: #3b7dd8;
				--active-color-light: #6ab0f3;
				--menu-bg: #000;
				--menu-hover: #999;
				--placeholder-bg: #f0f0f0;
			}

			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
				line-height: 1.7;
				color: var(--text-primary);
				background: #fff;
				-webkit-font-smoothing: antialiased;
			}

			/* Navigation */
			.site-header {
				position: sticky;
				top: 0;
				z-index: 100;
				background: #fff;
			}

			.site-header nav {
				border-bottom: 1px solid var(--border-color);
			}

			.nav-container {
				max-width: 1200px;
				margin: 0 auto;
				padding: 1.5rem 2rem;
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			.nav-left {
				display: flex;
				align-items: center;
				gap: 2rem;
			}

			.logo {
				font-size: 1.1rem;
				font-weight: 400;
				letter-spacing: 0.5px;
				text-decoration: none;
				color: var(--text-primary);
			}

			/* Hamburger Icon */
			.hamburger {
				background: none;
				border: none;
				cursor: pointer;
				padding: 0;
				width: 30px;
				height: 24px;
				position: relative;
			}

			.hamburger span {
				display: block;
				width: 100%;
				height: 3px;
				background: var(--text-primary);
				position: absolute;
				left: 0;
				transition: transform 0.3s, opacity 0.3s, top 0.3s;
			}

			.hamburger span:nth-child(1) {
				top: 0;
			}

			.hamburger span:nth-child(2) {
				top: 10px;
			}

			.hamburger span:nth-child(3) {
				top: 20px;
			}

			/* Desktop Navigation */
			.desktop-nav {
				display: flex;
				align-items: center;
				gap: 2.5rem;
				list-style: none;
			}

			.desktop-nav > li {
				position: relative;
			}

			.desktop-nav > li > a {
				text-decoration: none;
				color: var(--text-primary);
				font-size: 0.95rem;
				letter-spacing: 0.5px;
				transition: color 0.2s;
				font-weight: 400;
			}

			.desktop-nav > li > a:hover {
				color: var(--text-secondary);
			}

			/* Active page highlight */
			.desktop-nav > li > a.active {
				color: var(--active-color);
				border-bottom: 2px solid var(--active-color);
				padding-bottom: 2px;
			}

			/* Dropdown Menu */
			.dropdown {
				position: absolute;
				top: 100%;
				right: 0;
				background: #fff;
				border: 1px solid var(--border-color);
				min-width: 250px;
				padding: 1rem 0;
				opacity: 0;
				visibility: hidden;
				transform: translateY(-10px);
				transition: all 0.3s;
				box-shadow: 0 4px 12px rgba(0,0,0,0.1);
			}

			.desktop-nav > li:hover .dropdown,
			.desktop-nav > li:focus-within .dropdown {
				opacity: 1;
				visibility: visible;
				transform: translateY(0);
			}

			.dropdown a {
				display: block;
				padding: 0.75rem 1.5rem;
				color: var(--text-primary);
				text-decoration: none;
				font-size: 0.9rem;
				transition: background 0.2s;
			}

			.dropdown a:hover {
				background: var(--bg-hover);
			}

			/* Side Menu — Desktop: black side panel */
			.side-menu {
				position: fixed;
				top: 0;
				left: -400px;
				width: 400px;
				height: 100%;
				background: var(--menu-bg);
				z-index: 200;
				padding: 3rem 2rem;
				transition: left 0.3s;
				overflow-y: auto;
			}

			.side-menu.active {
				left: 0;
			}

			.menu-close {
				position: absolute;
				top: 2rem;
				right: 2rem;
				background: none;
				border: none;
				color: #fff;
				font-size: 2.5rem;
				cursor: pointer;
				width: 40px;
				height: 40px;
				display: flex;
				align-items: center;
				justify-content: center;
				line-height: 1;
				transition: color 0.2s;
			}

			.menu-close:hover {
				color: var(--menu-hover);
			}

			/* Overlay — desktop only */
			.menu-overlay-bg {
				display: none;
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0,0,0,0.5);
				z-index: 199;
			}

			.menu-overlay-bg.active {
				display: block;
			}

			.side-menu nav {
				margin-top: 4rem;
			}

			.side-menu ul {
				list-style: none;
			}

			.side-menu > nav > ul > li {
				margin-bottom: 2rem;
			}

			.side-menu a {
				color: #fff;
				text-decoration: none;
				font-size: 2rem;
				font-weight: 300;
				letter-spacing: -1px;
				transition: color 0.2s;
				display: block;
			}

			.side-menu a:hover {
				color: var(--menu-hover);
			}

			.side-menu a.active {
				color: var(--active-color-light);
			}

			/* Side menu submenu */
			.side-menu .submenu {
				margin-top: 0.75rem;
				padding-left: 1.5rem;
			}

			.side-menu .submenu li {
				margin-bottom: 0.5rem;
			}

			.side-menu .submenu a {
				font-size: 1.2rem;
				font-weight: 300;
			}

			/* Side menu social links */
			.side-menu .social-links {
				margin-top: 4rem;
				list-style: none;
			}

			.side-menu .social-links li {
				margin-bottom: 0.75rem;
			}

			.side-menu .social-links a {
				font-size: 1.2rem;
				font-weight: 300;
				display: flex;
				align-items: center;
				gap: 0.75rem;
			}

			.side-menu .social-links a svg {
				flex-shrink: 0;
			}

			/* Desktop nav social icons */
			.desktop-nav .nav-icon {
				display: flex;
				align-items: center;
			}

			/* Container */
			.container {
				max-width: 900px;
				margin: 0 auto;
				padding: 0 2rem;
			}

			/* Footer */
			footer {
				border-top: 1px solid var(--border-color);
				padding: 3rem 0;
				margin-top: 5rem;
			}

			footer .container {
				text-align: center;
				color: var(--text-secondary);
				font-size: 0.9rem;
			}

			/* Skip-to-content link */
			.skip-link {
				position: absolute;
				left: -9999px;
				top: 0;
				z-index: 999;
				padding: 0.75rem 1.5rem;
				background: var(--text-primary);
				color: #fff;
				text-decoration: none;
				font-size: 0.95rem;
			}

			.skip-link:focus {
				left: 1rem;
				top: 1rem;
			}

			/* Focus-visible indicators (WCAG 2.4.7) */
			a:focus-visible,
			button:focus-visible {
				outline: 2px solid var(--active-color);
				outline-offset: 2px;
			}

			.side-menu a:focus-visible {
				outline-color: var(--active-color-light);
			}

			/* Responsive */
			@media (max-width: 968px) {
				.desktop-nav {
					display: none;
				}

				/* Mobile: fullscreen white menu */
				.site-header {
					z-index: 300;
				}

				.side-menu {
					left: 0;
					width: 100%;
					background: #fff;
					padding: 6rem 2rem 3rem;
					transition: opacity 0.3s, visibility 0.3s;
					opacity: 0;
					visibility: hidden;
				}

				.side-menu.active {
					opacity: 1;
					visibility: visible;
				}

				.menu-close {
					display: none;
				}

				.menu-overlay-bg,
				.menu-overlay-bg.active {
					display: none;
				}

				.side-menu nav {
					max-width: 400px;
					margin: 0 auto;
				}

				.side-menu a {
					color: var(--text-primary);
				}

				.side-menu a:hover {
					color: var(--text-secondary);
				}

				.side-menu a.active {
					color: var(--active-color);
				}

				.side-menu a:focus-visible {
					outline-color: var(--active-color);
				}

				.side-menu .social-links {
					border-top: 1px solid var(--border-color);
					padding-top: 2rem;
				}

				/* Hamburger → Cross animation (mobile only) */
				.hamburger.active span:nth-child(1) {
					top: 10px;
					transform: rotate(45deg);
				}

				.hamburger.active span:nth-child(2) {
					opacity: 0;
				}

				.hamburger.active span:nth-child(3) {
					top: 10px;
					transform: rotate(-45deg);
				}
			}

			@media (max-width: 768px) {
				.side-menu a {
					font-size: 1.5rem;
				}

				.side-menu .submenu a {
					font-size: 1rem;
				}

				.container {
					padding: 0 1.5rem;
				}
			}
		</style>
	</head>
	<body>
		<a href="#main-content" class="skip-link">Saltar para o conteúdo</a>
		<header class="site-header">
			<nav>
				<div class="nav-container">
					<div class="nav-left">
						<button class="hamburger" id="hamburgerBtn" aria-label="Menu" aria-expanded="false">
							<span></span>
							<span></span>
							<span></span>
						</button>
						<a href="/" class="logo">CARLOS ALELUIA</a>
					</div>
					
					<!-- Desktop Navigation with Dropdown -->
					<ul class="desktop-nav">
						<li><a href="/" class:list={[{ active: currentPath === '/' }]}>Home</a></li>
						<li>
							<a href="/livros" class:list={[{ active: currentPath.startsWith('/livros') }]}>Livros</a>
							<div class="dropdown">
								{books.map((book) => (
									<a href={`/livros/${book.id}`}>{book.data.title}</a>
								))}
							</div>
						</li>
						<li><a href="/online" class:list={[{ active: currentPath.startsWith('/online') }]}>Online</a></li>
						<li><a href="/sobre" class:list={[{ active: currentPath === '/sobre' }]}>Sobre</a></li>
						<li>
							<a href="https://www.instagram.com/carlos.aleluia.t/" target="_blank" rel="noopener noreferrer" aria-label="Instagram" class="nav-icon">
								<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>
							</a>
						</li>
						<li>
							<a href="https://www.goodreads.com/author/show/22010507.Carlos_Aleluia" target="_blank" rel="noopener noreferrer" aria-label="Goodreads" class="nav-icon">
								<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M11.43 23.995c-3.608-.208-6.274-2.077-6.448-5.078.695.007 1.375-.013 2.07-.006.224 1.342 1.065 2.43 2.683 3.026 1.583.496 3.737.46 5.082-.174 1.527-.718 2.279-1.96 2.604-3.589.158-.748.2-1.58.202-2.37l-.037-.186c-.555.91-1.275 1.633-2.166 2.124-1.537.848-3.7.986-5.577.384-2.551-.819-3.977-2.845-4.453-5.291-.263-1.355-.2-2.813.133-4.145.576-2.3 2.09-4.025 4.235-4.87 1.768-.695 3.726-.678 5.225.165.776.435 1.325 1.01 1.783 1.676l.054-.015.015-1.554h1.96l-.013 12.298c-.007 1.15-.098 2.144-.378 3.123-.726 2.532-2.603 4.2-5.482 4.552-.488.06-.984.088-1.492.09v-.16zm2.601-7.736c1.09-.527 1.81-1.42 2.182-2.56.373-1.138.378-2.442.183-3.602-.236-1.406-.73-2.588-1.774-3.39-.847-.651-2.06-.898-3.182-.746-1.478.2-2.482 1.048-3.06 2.293-.474 1.023-.635 2.26-.534 3.473.105 1.267.44 2.418 1.2 3.345.718.877 1.742 1.36 2.988 1.37 1.114-.003 1.912-.28 2.007-.183h-.01z"/></svg>
							</a>
						</li>
					</ul>
				</div>
			</nav>
		</header>

		<!-- Side Menu -->
		<div class="menu-overlay-bg" id="menuOverlayBg"></div>
		<div class="side-menu" id="sideMenu">
			<button class="menu-close" id="menuClose" aria-label="Fechar">×</button>
			<nav>
				<ul>
					<li><a href="/" class:list={[{ active: currentPath === '/' }]}>Home</a></li>
					<li>
						<a href="/livros" class:list={[{ active: currentPath.startsWith('/livros') }]}>Livros</a>
						<ul class="submenu">
							{books.map((book) => (
								<li><a href={`/livros/${book.id}`} class:list={[{ active: currentPath === `/livros/${book.id}` }]}>{book.data.title}</a></li>
							))}
						</ul>
					</li>
					<li><a href="/online" class:list={[{ active: currentPath.startsWith('/online') }]}>Online</a></li>
					<li><a href="/sobre" class:list={[{ active: currentPath === '/sobre' }]}>Sobre</a></li>
				</ul>
				<ul class="social-links">
					<li>
						<a href="https://www.instagram.com/carlos.aleluia.t/" target="_blank" rel="noopener noreferrer">
							<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>
							Instagram
						</a>
					</li>
					<li>
						<a href="https://www.goodreads.com/author/show/22010507.Carlos_Aleluia" target="_blank" rel="noopener noreferrer">
							<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M11.43 23.995c-3.608-.208-6.274-2.077-6.448-5.078.695.007 1.375-.013 2.07-.006.224 1.342 1.065 2.43 2.683 3.026 1.583.496 3.737.46 5.082-.174 1.527-.718 2.279-1.96 2.604-3.589.158-.748.2-1.58.202-2.37l-.037-.186c-.555.91-1.275 1.633-2.166 2.124-1.537.848-3.7.986-5.577.384-2.551-.819-3.977-2.845-4.453-5.291-.263-1.355-.2-2.813.133-4.145.576-2.3 2.09-4.025 4.235-4.87 1.768-.695 3.726-.678 5.225.165.776.435 1.325 1.01 1.783 1.676l.054-.015.015-1.554h1.96l-.013 12.298c-.007 1.15-.098 2.144-.378 3.123-.726 2.532-2.603 4.2-5.482 4.552-.488.06-.984.088-1.492.09v-.16zm2.601-7.736c1.09-.527 1.81-1.42 2.182-2.56.373-1.138.378-2.442.183-3.602-.236-1.406-.73-2.588-1.774-3.39-.847-.651-2.06-.898-3.182-.746-1.478.2-2.482 1.048-3.06 2.293-.474 1.023-.635 2.26-.534 3.473.105 1.267.44 2.418 1.2 3.345.718.877 1.742 1.36 2.988 1.37 1.114-.003 1.912-.28 2.007-.183h-.01z"/></svg>
							Goodreads
						</a>
					</li>
				</ul>
			</nav>
		</div>

		<main id="main-content">
			<slot />
		</main>

		<footer>
			<div class="container">
				<p>© {new Date().getFullYear()} Carlos Aleluia. Todos os direitos reservados.</p>
			</div>
		</footer>

		<script>
			const hamburgerBtn = document.getElementById('hamburgerBtn');
			const sideMenu = document.getElementById('sideMenu');
			const menuOverlayBg = document.getElementById('menuOverlayBg');
			const menuClose = document.getElementById('menuClose');

			const focusableSelectors = 'a[href], button, [tabindex]:not([tabindex="-1"])';

			function toggleMenu() {
				const isOpen = sideMenu?.classList.contains('active');
				if (isOpen) {
					closeMenu();
				} else {
					openMenu();
				}
			}

			function openMenu() {
				sideMenu?.classList.add('active');
				menuOverlayBg?.classList.add('active');
				hamburgerBtn?.classList.add('active');
				hamburgerBtn?.setAttribute('aria-expanded', 'true');
				document.body.style.overflow = 'hidden';
			}

			function closeMenu() {
				sideMenu?.classList.remove('active');
				menuOverlayBg?.classList.remove('active');
				hamburgerBtn?.classList.remove('active');
				hamburgerBtn?.setAttribute('aria-expanded', 'false');
				document.body.style.overflow = '';
				hamburgerBtn?.focus();
			}

			hamburgerBtn?.addEventListener('click', toggleMenu);
			menuClose?.addEventListener('click', closeMenu);
			menuOverlayBg?.addEventListener('click', closeMenu);

			// Escape key closes menu
			document.addEventListener('keydown', (e) => {
				if (e.key === 'Escape' && sideMenu?.classList.contains('active')) {
					closeMenu();
				}
			});

			// Trap focus inside open menu
			sideMenu?.addEventListener('keydown', (e) => {
				if (e.key !== 'Tab') return;
				const focusable = Array.from(sideMenu.querySelectorAll(focusableSelectors)) as HTMLElement[];
				if (focusable.length === 0) return;
				const first = focusable[0];
				const last = focusable[focusable.length - 1];
				if (e.shiftKey && document.activeElement === first) {
					e.preventDefault();
					last.focus();
				} else if (!e.shiftKey && document.activeElement === last) {
					e.preventDefault();
					first.focus();
				}
			});

			// Close menu when clicking a link
			const sideMenuLinks = sideMenu?.querySelectorAll('a');
			sideMenuLinks?.forEach(link => {
				link.addEventListener('click', closeMenu);
			});

			// Scroll to top when clicking a link to the current page
			const path = window.location.pathname.replace(/\/$/, '') || '/';
			document.querySelectorAll('a[href]').forEach(link => {
				const href = (link.getAttribute('href') || '').replace(/\/$/, '') || '/';
				if (href === path && !link.hasAttribute('target')) {
					link.addEventListener('click', (e) => {
						e.preventDefault();
						window.scrollTo({ top: 0, behavior: 'smooth' });
					});
				}
			});
		</script>
	</body>
</html>